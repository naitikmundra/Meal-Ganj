<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <title>Meal Ganj</title>
  <meta content="" name="description">
  <meta content="" name="keywords">

  <link href="assets/img/favicon.png" rel="icon">
  <link href="assets/img/apple-touch-icon.png" rel="apple-touch-icon">

  <link href="https://fonts.googleapis.com" rel="preconnect">
  <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet">

  <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
  <link href="assets/vendor/aos/aos.css" rel="stylesheet">
  <link href="assets/vendor/fontawesome-free/css/all.min.css" rel="stylesheet">
  <link href="assets/vendor/glightbox/css/glightbox.min.css" rel="stylesheet">
  <link href="assets/vendor/swiper/swiper-bundle.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />

  <link href="assets/css/main.css" rel="stylesheet">
    <style>
        #map {
            height: 600px;
            width: 100%;
        }
    </style>
 
</head>

<body class="index-page">

  <header id="header" class="header d-flex align-items-center fixed-top">
    <div class="container-fluid container-xl position-relative d-flex align-items-center">

      <a href="index.html" class="logo d-flex align-items-center me-auto">
        <img src="assets/img/logo.png" alt=""> 
        <h1 class="sitename">MealGanj</h1>
      </a>

      <nav id="navmenu" class="navmenu">
        <ul>
          <li><a href="index.html" class="active">Home<br></a></li>
          <li><a href="#about">About</a></li>
          <li><a href = "#" onclick="convertohindi()">हिंदी में पढ़ें।</a></li>
        </ul>
        <i class="mobile-nav-toggle d-xl-none bi bi-list"></i>
      </nav>

      <a class="btn-getstarted" href="#get-a-quote">Spare food?</a>
    
    </div>
  </header>

  <main class="main">

    <!-- Hero Section -->
    <section id="hero" class="hero section">

      <img src="assets/img/world-dotted-map.png" alt="" class="hero-bg" data-aos="fade-in">

      <div class="container">
        <div class="row gy-4 d-flex justify-content-between">
          <div class="col-lg-6 order-2 order-lg-1 d-flex flex-column justify-content-center">
            <h2 data-aos="fade-up" class="hindi" >Food for the Needy.</h2>
            <p data-aos="fade-up" data-aos-delay="100" class="hindi">Do you see some people who need food? Or are you hungry yourself and need food for yourself or your family as you can't afford it? Don't worry Meal Ganj has came to rescue. Search your location below and find the nearest place where food is being left to be wasted which is as fresh as new! Don't let it go waste :)</p>

        
            <form id="locationForm"   class="form-search d-flex align-items-stretch mb-3" data-aos="fade-up" data-aos-delay="200">
              <input type="text" id="streetName" class="form-control hindi" placeholder="Need food? Enter Area Name e.g. Ram Ganj">
              <button type="submit" class="btn btn-primary">Search</button>
            </form>
           <p data-aos="fade-up" data-aos-delay="300">Currently limited to Ajmer City, Rajasthan, India</p> 					
            <div class="row gy-4" data-aos="fade-up" data-aos-delay="300">

              <div class="col-lg-3 col-6">
                <div class="stats-item text-center w-100 h-100">
                  <span data-purecounter-start="0" data-purecounter-end="500+" data-purecounter-duration="0" class="purecounter">500+</span>
                  <p >Needy served</p>
                </div>
              </div><!-- End Stats Item -->

              <div class="col-lg-3 col-6">
                <div class="stats-item text-center w-100 h-100">
                  <span data-purecounter-start="0" data-purecounter-end="300+" data-purecounter-duration="0" class="purecounter">300+</span>
                  <p>Volunteers</p>
                </div>
              </div><!-- End Stats Item -->

              <div class="col-lg-3 col-6">
                <div class="stats-item text-center w-100 h-100">
                  <span data-purecounter-start="0" data-purecounter-end="200+" data-purecounter-duration="0" class="purecounter">200+</span>
                  <p>Food donaters</p>
                </div>
              </div><!-- End Stats Item -->

              

            </div>

          </div>

          <div class="col-lg-5 order-1 order-lg-2 hero-img" data-aos="zoom-out">
            <img src="assets/img/hero-img.png" class="img-fluid mb-3 mb-lg-0" alt="">
          </div>

        </div>
      </div>

    </section><!-- /Hero Section -->
    <section>
        <div id="map"></div>
</section>


    <!-- About Section -->
    <section id="about" class="about section">

      <div class="container">

        <div class="row gy-4">

          <div class="col-lg-6 position-relative align-self-start order-lg-last order-first" data-aos="fade-up" data-aos-delay="200">
            <img src="assets/img/logo.png" class="img-fluid" alt="">
            <a href="https://youtu.be/Fromv5PpBUs?feature=shared" class="glightbox play-btn"></a>
          </div>

          <div class="col-lg-6 content order-last  order-lg-first" data-aos="fade-up" data-aos-delay="100">
            <h3>About Us</h3>
            
             
          </div>

        </div>

      </div>

    </section><!-- /About Section -->
   <section id="get-a-quote" class="get-a-quote section">

      <div class="container">

        <div class="row g-0" data-aos="fade-up" data-aos-delay="100">

          <div class="col-lg-5 quote-bg" style="background-image: url(assets/img/quote-bg.jpg);"></div>

          <div class="col-lg-7" data-aos="fade-up" data-aos-delay="200">

            <form action = "#"id="listings" class="php-email-form">
              <h3>List available spare food</h3>
              <p>Make sure the food is edible, earn blessings of the people whom you help.</p>

              <div class="row gy-4">

                <div class="col-md-6">
                  <input type="text" name="departure" id="food" class="form-control" placeholder="About the food" required="">
                </div>

                <div class="col-md-6">
                  <input type="text" name="delivery" class="form-control" placeholder="Can feed no. of people" required="">
                </div>


                <div class="col-lg-12">
                  <h4>Your Personal Details</h4>
                </div>

                <div class="col-md-12">
                  <input type="text" name="name" id = "name" class="form-control" placeholder="Name" required="">
                </div>

                <div class="col-md-12 ">
                  <input type="email" class="form-control" id="email" name="email" placeholder="Email" required="">
                </div>

                <div class="col-md-12">
                  <input type="text" class="form-control" id="mobile" name="phone" placeholder="Phone" required="">
                </div>
                <p>* Phone no would be visible in map listing</p>
  				 <div class="col-lg-12">
                  <h4>Address where food is available.</h4>
                </div>
                <div class="col-md-12">
                  <textarea class="form-control" name="message" id = "address" rows="6" placeholder="Address (In Ajmer*)" required=""></textarea>
                </div>

                	<input type="checkbox" id="onpc"  name="">
<label for="onpc">Are you on Desktop or a device with no proper gps?</label>
                  <button type="submit">Allow Location and List Food</button>

              </div>
            </form>
          </div><!-- End Quote Form -->

        </div>

      </div>

    </section><!-- /Get A Quote Section -->
  
   

  </main>

  <footer id="footer" class="footer">

    <div class="container footer-top">
      <div class="row gy-4">
        <div class="col-lg-5 col-md-12 footer-about">
          <a href="index.html" class="logo d-flex align-items-center">
            <span class="sitename">Meal Ganj</span>
		  <p>Solving hunger.</p>
          </a>
         
        </div>

        <div class="col-lg-2 col-6 footer-links">
          
        </div>



        <div class="col-lg-3 col-md-12 footer-contact text-center text-md-start">
          <h4>Contact Us</h4>
          <p>naitikmundra18@gmail.com</p>
          
        </div>

      </div>
    </div>

    

  </footer>

  <!-- Scroll Top -->
  <a href="#" id="scroll-top" class="scroll-top d-flex align-items-center justify-content-center"><i class="bi bi-arrow-up-short"></i></a>

  <!-- Preloader -->
  <div id="preloader"></div>

  <!-- Vendor JS Files -->
  <script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script src="assets/vendor/aos/aos.js"></script>
  <script src="assets/vendor/purecounter/purecounter_vanilla.js"></script>
  <script src="assets/vendor/glightbox/js/glightbox.min.js"></script>
  <script src="assets/vendor/swiper/swiper-bundle.min.js"></script>
<script type="text/javascript">
	  let documentsDict = {}; // Initialize an empty dictionary

</script>
  <!-- Main JS File -->
  <script src="assets/js/main.js"></script>
<!-- Firebase scripts -->

	  <script type="module" >
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-app.js";
import { getFirestore, collection, addDoc, getDoc, getDocs} from "https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore.js";
	console.log("init");

  // Your web app's Firebase configuration
  const firebaseConfig = {
  apiKey: "AIzaSyAX3ZM8ZPotB_XT7u3vuMZ3UYUhzC2q3cQ",
  authDomain: "meal-ganj.firebaseapp.com",
  projectId: "meal-ganj",
  storageBucket: "meal-ganj.appspot.com",
  messagingSenderId: "145304337454",
  appId: "1:145304337454:web:60cc22fb7807cfa3e3b3bf"
  };

  // Initialize Firebase
  initializeApp(firebaseConfig);

  // Initialize Firestore


  const db = getFirestore();

	const collectionRef = collection(db, "listings");
getDocs(collectionRef)
  .then((querySnapshot) => {
    querySnapshot.forEach((doc) => {
      // Store each document data in the dictionary with its ID as the key
      documentsDict[doc.id] = doc.data();
    });
    console.log("Documents Dictionary:", documentsDict);
  })
  .catch((error) => {
    console.error("Error getting documents:", error);
  });
// Function to add data to Firestore
function addDataToFirestore(name, food, email,address,latitude,longitude,mobile) {
    // Collection reference
	const collectionRef = collection(db, "listings");
    
    // Data to be added
    const data = {
        Name: name,
        Address: address,
        Email: email,
        Lat : latitude,
        Lang: longitude,
        food: food,
        Mobile:mobile

    };

  // Add data to Firestore with addDoc
  addDoc(collectionRef, data)
    .then((docRef) => {
      console.log("Document written with ID: ", docRef.id);
      // Optionally, reset the form after successful submission
      document.getElementById('listings').reset();
    })
    .catch((error) => {
      console.error("Error adding document: ", error);
    });
}

  	// Add event listener to form submit event
document.getElementById('listings').addEventListener('submit', function(e) {
	var checkbox = document.getElementById('onpc');

    e.preventDefault(); // Prevent form submission
    // Check if geolocation is supported
    if ('geolocation' in navigator && !checkbox.checked) {
        // Request permission to access the user's location
        navigator.geolocation.getCurrentPosition((position) => {
            // Store latitude and longitude in variables
            let latitude = position.coords.latitude;
            let longitude = position.coords.longitude;
            console.log("Latitude: ", latitude);
            console.log("Longitude: ", longitude);
		    // Get form input values
		    const name = document.getElementById('name').value;
		    const food = document.getElementById('food').value;
		    const email = document.getElementById('email').value;
		    const address = document.getElementById('address').value;
		    const mobile = document.getElementById('mobile').value;

		    // Add data to Firestore
		    addDataToFirestore(name, food, email,address, mobile,latitude,longitude,mobile);


        }, (error) => {
            // Handle errors, like permission denied
            alert('Error getting location:', error, 'Please allow Location (re submit the form)');

        });

    } else {
        console.error('Geolocation is not supported.');
		    // Get form input values
		    const name = document.getElementById('name').value;
		    const food = document.getElementById('food').value;
		    const email = document.getElementById('email').value;
		    const address = document.getElementById('address').value;
		    const mobile = document.getElementById('mobile').value;

		    // Add data to Firestore
		    addDataToFirestore(name, food, email,address, 0,0,mobile);
    }

});
</script>
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
	function convertohindi() {
  document.querySelector('h2.hindi').textContent = 'ज़रूरतमंदों के लिए भोजन।';
  document.querySelector('p.hindi').textContent = 'क्या आप कुछ लोगों को देखते हैं जिन्हें भोजन की आवश्यकता है? या आप खुद भूखे हैं और अपने या अपने परिवार के लिए भोजन की आवश्यकता है क्योंकि आप इसे वहन नहीं कर सकते? चिंता मत करो, मील गंज बचाव के लिए आया है। नीचे अपने स्थान की खोज करें और निकटतम स्थान खोजें जहां भोजन बर्बाद होने के लिए छोड़ा जा रहा है जो नया जैसा ताजा है! इसे बर्बाद न होने दें :)';
  document.querySelector('input.hindi').placeholder = 'भोजन की आवश्यकता है? क्षेत्र का नाम दर्ज करें जैसे राम गंज';
}
    const ajmerLat = 26.4499; // Latitude for Ajmer, Rajasthan, India
    const ajmerLng = 74.6399; // Longitude for Ajmer, Rajasthan, India
    const apiKey = '7371dbf50b924156a23332411391482b'; // Replace with your OpenCage API key

    const map = L.map('map', {
        center: [ajmerLat, ajmerLng],
        zoom: 13,
        minZoom: 13,
        maxBounds: [[26.3499, 74.5399], [26.5499, 74.7399]]
    });

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
    }).addTo(map);

    // Ensure the map stays within the bounds
    map.on('drag', function() {
        map.panInsideBounds(map.options.maxBounds, { animate: false });
    });
    	currentMarker = null;
    document.getElementById('locationForm').addEventListener('submit', async function(e) {
        e.preventDefault(); // Prevent the form from submitting the traditional way
        const streetName = document.getElementById('streetName').value;
        if (streetName.trim() !== '') { // Check if the street name is not empty
            const location = await geocodePlace(apiKey, streetName + ", Ajmer, Rajasthan, India");
            if (location) {
            	                if (currentMarker) {
                    map.removeLayer(currentMarker);
                }
            	console.log(location.lat, location.lng);
                currentMarker = L.marker([location.lat, location.lng]).addTo(map)
                    .bindPopup(`<b>${streetName}</b><br>Your Location`)
                    .openPopup();
                map.setView([location.lat, location.lng], 15);
                 document.getElementById('map').scrollIntoView({ behavior: 'smooth' });

            // Iterate through documentsDict and place markers for each location
            for (const documentId in documentsDict) {
                const docData = documentsDict[documentId];
                const { Lat, Lang, Address, food, Mobile } = docData;
                if (Lat !== 0 && Lang !== 0) {
                	console.log("added", Lat, Lang, food, Mobile);
                    L.marker([Lat, Lang]).addTo(map)
                        .bindPopup(`<b>${Address}</b><br>Food: ${food}<br>Mobile: ${Mobile}`);
                } else {
                    // If Lat and Lang are 0, try to convert address to Lat and Lang
                    const locationFromAddress = await geocodePlace(apiKey, Address);
                    if (locationFromAddress) {
                        L.marker([locationFromAddress.lat, locationFromAddress.lng]).addTo(map)
                            .bindPopup(`<b>${Address}</b><br>Food: ${food}<br>Mobile: ${Mobile}`);
                    } else {
                        console.error('Invalid address:', Address);
                    }
                }
            }
            } else {
                alert('No results found for the specified street name.');
            }
        } else {
            alert('Please enter a valid street name.');
        }
    });

    async function geocodePlace(apiKey, placeName) {
        const response = await fetch(`https://api.opencagedata.com/geocode/v1/json?q=${encodeURIComponent(placeName)}&key=${apiKey}`);
        const data = await response.json();
        if (data.results.length > 0) {
            const { lat, lng } = data.results[0].geometry;
            return { lat, lng };
        } else {
            console.error('No results found for', placeName);
            return null;
        }
    }
 
</script>
    
</body>

</html>
